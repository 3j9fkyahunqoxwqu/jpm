#!/usr/bin/env node

var VERSION = "0.1.0";
var program = require("commander");
var utils = require("../lib/utils");
var console = utils.console;
var run = require("../lib/run");
var test = require("../lib/test");
var xpi = require("../lib/xpi");

program
  .version(VERSION)
  .option("-m, --mode <action>", "action to run [run|test|xpi]")
  .option("-b, --binary <path>", "path of Firefox binary to use")
  .parse(process.argv);

var manifest = utils.getManifest();
console.log("Running " + program.mode + " on " + (manifest.title || manifest.name));

// cfx xpi
if (program.mode === "xpi") {
  xpi(manifest, program).then(function (xpiPath) {
    console.log("Successfully created xpi at " + xpiPath);
  }, function (reason) {
    console.error("xpi creation failed.", reason);
  });
}
// cfx run
else {
  run(manifest, program).then(null, console.error);
}
